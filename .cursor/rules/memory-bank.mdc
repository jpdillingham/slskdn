---
description: Memory Bank - Persistent context for AI-assisted development
globs: ["**/*"]
alwaysApply: true
---

# Memory Bank System

## Before Writing ANY Code

1. **Read the gotchas**: `memory-bank/decisions/adr-0001-known-gotchas.md`
2. **Read the patterns**: `memory-bank/decisions/adr-0002-code-patterns.md`
3. **Read the anti-slop rules**: `memory-bank/decisions/adr-0003-anti-slop-rules.md`
4. **Check active context**: `memory-bank/activeContext.md`

## Grep Before You Write

Before creating any new code, search for existing patterns:

```bash
# Find how similar services are structured
grep -rn "public class.*Service" src/slskd/

# Find how API endpoints are defined
grep -rn "\[Http" src/slskd/*/API/

# Find how frontend components fetch data
grep -rn "const fetch = async" src/web/src/components/
```

## File Purposes

| File | Purpose | When to Update |
|------|---------|----------------|
| `projectbrief.md` | Vision, tech stack, constraints | Rarely |
| `tasks.md` | Task list (source of truth) | After completing/adding tasks |
| `activeContext.md` | Current session state | Start/end of each session |
| `progress.md` | Chronological work log | After completing work |
| `scratch.md` | Temp notes, quick reference | Anytime |
| `decisions/adr-*.md` | Architectural decisions | When making significant choices |

## Critical Rules

### API Library Functions MUST Return Safe Values
```javascript
// CORRECT
return Array.isArray(response) ? response : [];

// WRONG - causes crashes
return response;  // might be undefined
```

### Async Event Handlers MUST Have Try-Catch
```csharp
// CORRECT
private async void Handler(object s, EventArgs e)
{
    try { await Work(); }
    catch (Exception ex) { Logger.Error(ex, "..."); }
}

// WRONG - crashes the process
private async void Handler(object s, EventArgs e)
{
    await Work();
}
```

### Don't Add Abstractions That Don't Exist
- No factory patterns
- No wrapper classes
- No defensive null checks on internal code
- No logging method entry/exit

## Task Format

```markdown
- [ ] **T-NNN**: Task Title
  - Status: pending | in-progress | done
  - Priority: P0 | P1 | P2
  - Branch: `branch-name`
  - Notes: relevant details
```

## Progress Entry Format

```markdown
## YYYY-MM-DD HH:MM

### Completed
- What was done

### Decisions
- Why certain choices were made

### Next
- What to do next
```
